<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="icon" type="image/png" sizes="32x32" href="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/theme/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/theme/favicon.ico">
  <link rel="alternate" href="/atom.xml" title="Houmin" type="application/atom+xml">
  <meta name="google-site-verification" content="zdGhdEF7jHoJW58lsdN6l9JrQFjJFwakCIc7TbbosV0">
  <meta name="msvalidate.01" content="2F527B379ED5537861D0D38C2C754C2B">
  <meta name="baidu-site-verification" content="xAag2PqzKE">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":true},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":true,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: true,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="依赖管理是每一种编程语言无法避免的一个问题，在一个复杂的项目中如何管理其依赖的软件版本，如何避免 「菱形依赖」 ，如何实现 Reproducible Build，如何实现依赖软件版本的平稳升级，都是在大型软件工程中需要正视和解决的问题。从 Java 的 Maven，到 Rust 的 Cargo，再到 NodeJS 的 npm，各个语言都给出了自己的解决方案。对于 Go 语言，从最早的 GOPATH">
<meta name="keywords" content="Go,Dependency Management,Package Management">
<meta property="og:type" content="article">
<meta property="og:title" content="【Go语言设计与实现】Go Module">
<meta property="og:url" content="http://houmin.cc/posts/55d129f1/index.html">
<meta property="og:site_name" content="Houmin">
<meta property="og:description" content="依赖管理是每一种编程语言无法避免的一个问题，在一个复杂的项目中如何管理其依赖的软件版本，如何避免 「菱形依赖」 ，如何实现 Reproducible Build，如何实现依赖软件版本的平稳升级，都是在大型软件工程中需要正视和解决的问题。从 Java 的 Maven，到 Rust 的 Cargo，再到 NodeJS 的 npm，各个语言都给出了自己的解决方案。对于 Go 语言，从最早的 GOPATH">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://tonybai.com/wp-content/uploads/google-trunk-based-and-release-branch-dev-model.png">
<meta property="og:image" content="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/blog/2021-02-06_go-mod-impver.png">
<meta property="og:image" content="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/blog/2021-02-06_go-mod-version-select.png">
<meta property="og:image" content="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/blog/2021-02-06_go-mod-version-select-list.png">
<meta property="og:image" content="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/blog/2021-02_05_go-module-proxy-life-of-a-query.png">
<meta property="og:image" content="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/blog/2021-02-05_go-module-sumdb.png">
<meta property="og:updated_time" content="2021-02-07T11:15:55.139Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tonybai.com/wp-content/uploads/google-trunk-based-and-release-branch-dev-model.png">

<link rel="canonical" href="http://houmin.cc/posts/55d129f1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>【Go语言设计与实现】Go Module | Houmin</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


  <script src="/js/photoswipe.min.js?v="></script>
  <script src="/js/photoswipe-ui-default.min.js?v="></script>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Houmin</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">Yesterday You Said Tomorrow</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-album">

    <a href="/album" rel="section"><i class="fa fa-fw fa-camera"></i>相册</a>

  </li>
        <li class="menu-item menu-item-movies">

    <a href="/movies/" rel="section"><i class="fa fa-fw fa-film"></i>观影</a>

  </li>
        <li class="menu-item menu-item-books">

    <a href="/books/" rel="section"><i class="fa fa-fw fa-book"></i>阅读</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://houmin.cc/posts/55d129f1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/theme/avatar.png">
      <meta itemprop="name" content="Houmin">
      <meta itemprop="description" content="丈夫拥书万卷，何假南面百城">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Houmin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          【Go语言设计与实现】Go Module
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-07 22:07:31" itemprop="dateCreated datePublished" datetime="2020-05-07T22:07:31+08:00">2020-05-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%AF%E4%B8%9A%E4%B8%93%E6%94%BB/" itemprop="url" rel="index">
                    <span itemprop="name">术业专攻</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/posts/55d129f1/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/posts/55d129f1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>15k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>27 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>依赖管理是每一种编程语言无法避免的一个问题，在一个复杂的项目中如何管理其依赖的软件版本，如何避免 <a href="https://en.wikipedia.org/wiki/Dependency_hell" target="_blank" rel="external nofollow noopener noreferrer">「菱形依赖」</a> ，如何实现 <code>Reproducible Build</code>，如何实现依赖软件版本的平稳升级，都是在大型软件工程中需要正视和解决的问题。从 Java 的 Maven，到 Rust 的 Cargo，再到 NodeJS 的 npm，各个语言都给出了自己的解决方案。对于 Go 语言，从最早的 <code>GOPATH</code>，到 Go 1.5 版本引入的 <code>vendor</code> 机制，以及基于 <code>vendor</code> 实现的 <code>dep</code>、<code>glide</code>、<code>govendor</code> 关键管理工具，各种问题依然存在。<code>Go Team</code> 在 Go 1.11 版本推出 <code>Go Module</code>，抛弃了 <code>GOPATH</code> 以来的设计，引入版本化语义、支持锁定版本等特性。本文将介绍 Go 语言在依赖管理问题上的来龙去脉，并介绍 <code>Go Module</code> 的设计原理与使用方法。</p>
<a id="more"></a>
<h2 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h2><p>为什么需要依赖？永远不要重复造轮子，你也不需要重复造轮子，通过复用已有的工作成果可以大大提高工作效率。然而，将已有的工作成果加入到我们自己的项目中作为依赖存在着太多的不确定性：</p>
<ul>
<li>这个包的 API 会变化</li>
<li>这个包内部行为会变化</li>
<li>这个包自己的依赖会变化</li>
<li>这个包可能已经已经不存在或无法访问</li>
<li>包与包之间的不同依赖相互冲突等等。</li>
</ul>
<p>不仅如此，随着软件开发规模的逐步增大，涉及到的外部依赖越来越多，手动管理的所有依赖愈发不可能。所以我们需要依赖管理，我们需要有个工具或者规范来描述和定义包与包之间的依赖关系，并自动化的去处理、解析和满足这些依赖。对于软件依赖管理工具，我们提出了下面两个要求：</p>
<ul>
<li>API 稳定性：我们都希望我们依赖的 API 是稳定的，不会因为我们更新了一个小版本就要大规模的重写我们的代码</li>
<li>可重现构建：相同的源码最后能得到同样的二进制或链接库</li>
</ul>
<h3 id="GOPATH"><a href="#GOPATH" class="headerlink" title="GOPATH"></a>GOPATH</h3><p>最初 Go 语言在代码构建设计方面深受Google内部开发实践的影响，这篇文章介绍了 <a href="https://cacm.acm.org/magazines/2016/7/204032-why-google-stores-billions-of-lines-of-code-in-a-single-repository/pdf" target="_blank" rel="external nofollow noopener noreferrer">为什么 Google 要采取这种方式</a>：</p>
<ul>
<li>单一代码库：所有的代码包都放在一个单一代码仓库，也即 <code>Single MonoRepo</code>，使用类似命名空间的包路径来区分包</li>
<li>基于主干开发：所有开发人员基于主干 <code>trunk/mainline</code> 开发，版本发布时所有的<code>bug/fix</code>和增强改进代码都是现在主干代码提交，然后从主干代码 <code>cherry-pick</code>出来一个 <code>release branch</code></li>
</ul>
<p><img alt data-src="https://tonybai.com/wp-content/uploads/google-trunk-based-and-release-branch-dev-model.png"></p>
<p>对应于这种方式，Go 语言设置了 <code>GOPATH</code> 机制: 所有的源代码都在 <code>$GOPATH/src</code> 目录下，执行 <code>go build</code> 会分别在 <code>$GOPATH/pkg</code> 目录下生成编译中间文件和在 <code>$GOPATH/bin</code> 目录下生成可执行文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── bin <span class="comment"># 放编译后的可执行文件，可执行文件名字与源代码文件名字一样</span></span><br><span class="line">├── pkg <span class="comment"># 放编译后的包文件，包文件名字与所在目录一样，注意：名字与 package 无关</span></span><br><span class="line">└── src <span class="comment"># 放源代码文件</span></span><br><span class="line">  └── github.com/foo/bar</span><br><span class="line">    └── bar.go</span><br></pre></td></tr></table></figure>
<p>在这种构建方式下，<code>go build</code> 会在<code>$GOROOT/src</code>和 <code>$GOPATH/src</code>下面按照 <code>import path</code> 去搜索package，由于go get 获取的都是各个package repo的 <code>trunk/mainline</code>的代码，因此，Go 1.5 之前的 Go compiler 都是基于目标Go程序依赖包的<code>trunk/mainline</code> 代码去编译的。这种构建方式至少存在以下问题：</p>
<ul>
<li><strong>对软件包版本无感知</strong>：<code>go get</code> 拉取软件包时，每次都是get最新的代码，这会导致不同人获取的软件包不同，从而编译的结果不一致</li>
<li><strong>对第三方软件包没有安全审计</strong>：获取最新的代码很容易引入代码新的Bug，后续运行时出了Bug需要解决，也无法版本跟踪管理</li>
<li><strong>依赖的完整性无法校验</strong>：基于域名的package名称，域名变化或子路径变化，都会导致无法正常下载依赖</li>
<li><strong>依赖关系无法持久化</strong>：需要在 <code>go get</code> 的时候找出所有的依赖包，然后一个一个 <code>go get</code> </li>
</ul>
<p>这还只是简单的软件依赖的问题，更不用说不同项目依赖同一个项目的不同版本，以及菱形依赖的问题了。</p>
<h3 id="Vendor"><a href="#Vendor" class="headerlink" title="Vendor"></a>Vendor</h3><p>为了实现 <code>Reproducible Build</code>，Go 1.5 引入了 Vendor 机制，Vendor 机制仍然是基于 <code>GOPATH</code> 机制，只是开发者将其依赖的包放到其工程子目录 <code>vendor</code> 目录下，有点类似于 <code>node.js</code> 的 <code>node_modules</code> ：</p>
<ul>
<li>vendor 机制支持嵌套 vendor，vendor中的第三方包中也可以包含vendor目录</li>
<li>若一个工程中存在着一个包的两个不同版本，可以放在不同的层次的vendor下</li>
</ul>
<p>在执行 <code>go build</code> 或 <code>go run</code> 命令时，会按照以下顺序去查找包：</p>
<ol>
<li>如果当前目录存在vendor目录，在当前vendor目录查找依赖包</li>
<li>如果当前目录不存在vendor目录，则到上一级目录继续查找</li>
<li>重复步骤1-2，直到到达<code>$GOPATH/src</code>目录，查找vendor目录中是否存在依赖包</li>
<li>如何没有查找到依赖包，则继续在<code>$GOROOT</code>目录查找</li>
<li>如果没有查找到依赖包，则继续在<code>$GOPATH/src</code>目录查找</li>
</ol>
<p>在此基础上，为了让开发者从手动添加依赖、手动更新依赖的困境中摆脱出来，社区开发了一系列的第三方工具，比如 <a href="https://github.com/kardianos/govendor" target="_blank" rel="external nofollow noopener noreferrer">govendor</a>、<a href="https://github.com/Masterminds/glide" target="_blank" rel="external nofollow noopener noreferrer">glide</a> 以及号称准官方工具的<a href="https://github.com/golang/dep" target="_blank" rel="external nofollow noopener noreferrer">dep</a>。这些工具会自动分析工程项目的依赖关系，并且批量下载对应版本的代码库，并复制到项目的 vendor 目录下。这些第三方工具大大提高了方便了开发者管理依赖关系，<a href="https://github.com/golang/dep" target="_blank" rel="external nofollow noopener noreferrer">dep</a> 似乎也即将从实验状态转正。</p>
<h3 id="Go-Module"><a href="#Go-Module" class="headerlink" title="Go Module"></a>Go Module</h3><p>然而，所有基于 vendor 机制实现的第三方依赖管理工具都存在着以下问题：</p>
<ul>
<li>vendor 机制是处于 <code>GOPATH</code> 体系中的，只有项目在 <code>GOPATH/src</code>下，vendor才有意义才起作用</li>
<li>同样版本的相同软件包，即使在不同工程中都使用了，也必须在各自的 vendor 目录下单独复制一份，无法实现复用</li>
</ul>
<p>基于以上的种种问题的考量，社区最终放弃了 vendor 机制，提出了 Go Module 方案，从此 Go 语言项目再也不需要放在 <code>GOPATH</code> 路径下，工程依赖的软件包被统一放到 <code>$GOPATH/pkg/mod</code> 目录下，实现 import 路径与项目路径的解耦。从 Go 1.13 版本开始，Go Module 已经默认开启，</p>
<h2 id="关键概念"><a href="#关键概念" class="headerlink" title="关键概念"></a>关键概念</h2><h3 id="Semantic-Import-Versioning"><a href="#Semantic-Import-Versioning" class="headerlink" title="Semantic Import Versioning"></a>Semantic Import Versioning</h3><p>这就为我们带来了语义导入版本控制（Semantic Import Versioning）。</p>
<p>首先所有的模块都必须遵循语义化版本规则：</p>
<p><img alt data-src="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/blog/2021-02-06_go-mod-impver.png"></p>
<p>其次，当主版本号大于等于 <code>v2</code> 时，这个 Module 的 import path 必须在尾部加上 <code>/vN</code>。</p>
<ul>
<li>在 go.mod 文件中： <code>module github.com/my/mod/v2</code></li>
<li>在 require 的时候： <code>require github.com/my/mod/v2 v2.0.0</code></li>
<li>在 import 的时候： <code>import &quot;github.com/my/mod/v2/mypkg&quot;</code></li>
</ul>
<p>最后，当主版本号为 <code>v0</code> 或者 <code>v1</code> 时，尾部的 <code>/v0</code> 或 <code>/v1</code> 可以省略。</p>
<p><strong>为什么在 import 路径可以忽略 v0 和 v1 的主版本号呢？</strong></p>
<ul>
<li>导入路径中忽略了 v0 版本的原因是：根据语义化版本规范，v0的这些版本完全没有兼容性保证，可以随意的引入破坏性变更，所以不需要显式的写出来</li>
<li>导入路径中忽略 v1 版本的原因是：考虑到许多开发人员创建一旦到达 v1 版本便永不改变的软件包，这是官方所鼓励的，不认为所有这些开发人员在无意发布 v2 版时都应被迫拥有明确的 v1 版本尾缀，这将导致 v1 版本变成“噪音”且无意义。</li>
</ul>
<blockquote>
<p><strong>Q：使用 Go modules 时可以同时依赖同一个模块的不同的两个或者多个小版本（修订版本号不同）吗？</strong></p>
<p><strong>A：</strong>不可以的，Go modules 只可以同时依赖一个模块的不同的两个或者多个大版本（主版本号不同）。比如可以同时依赖 <code>example.com/foobar@v1.2.3</code> 和 <code>example.com/foobar/v2@v2.3.4</code>，因为他们的模块路径（module path）不同，Go modules 规定主版本号不是 v0 或者 v1 时，那么主版本号必须显式地出现在模块路径的尾部。但是，同时依赖两个或者多个小版本是不支持的。比如如果模块 A 同时直接依赖了模块 B 和模块 C，且模块 A 直接依赖的是模块 C 的 v1.0.0 版本，然后模块 B 直接依赖的是模块 C 的 v1.0.1 版本，那么最终 Go modules 会为模块 A 选用模块 C 的 v1.0.1 版本而不是模块 A 的 go.mod 文件中指明的 v1.0.0 版本。</p>
<p>这是因为 Go modules 认为只要主版本号不变，那么剩下的都可以直接升级采用最新的。但是如果采用了最新的结果导致项目 Break 掉了，那么 Go modules 就会 Fallback 到上一个老的版本，比如在前面的例子中就会 Fallback 到 v1.0.0 版本。</p>
</blockquote>
<h3 id="Minimal-Version-Selection"><a href="#Minimal-Version-Selection" class="headerlink" title="Minimal Version Selection"></a>Minimal Version Selection</h3><p>现在我们已经可以定义出一个模块了，但是一个模块具体构建的时候到底选择是哪个版本呢？这就涉及到 Go Module 使用的最小版本选择（Minimal Version Selection）算法。它的工作方式是这样的：<strong>我们为每个模块指定的依赖都是可用于构建的最低版本，最后实际选择的版本是所有出现过的最低版本中的最大值</strong>。</p>
<p>我们现在有这样的一个依赖关系，A 会依赖 B，C，而 B，C 会去依赖 D，D 又会依赖 E。</p>
<p><img alt data-src="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/blog/2021-02-06_go-mod-version-select.png"></p>
<p>那么我们从 A 开始把每个模块依赖的版本都找出来，这样我们会首先得到一个粗略的清单。然后相同的模块我们总是取最大的版本，这样就能得到最终的依赖列表。</p>
<p><img alt data-src="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/blog/2021-02-06_go-mod-version-select-list.png"></p>
<p>为什么可以这样呢？</p>
<ul>
<li><code>导入兼容性规则</code> 规定了相同的导入路径，新包必须向后兼容旧包，因此只要 D 还是 v1 版本，不管是选择 v1.3 还是 v1.4 都是可以的，不会有破坏性的变更。</li>
<li><code>语义导入版本控制</code> 规定了不同的大版本需要使用不同的导入路径，因此假设 D 升级到了 v2 版本，那就应当选择 <code>D v1.4</code> 和 <code>D v2.0</code> 这两个包了。</li>
</ul>
<p>为什么要这样做呢？</p>
<p>为了可重现构建，为了降低复杂度。</p>
<p>大多数包管理工具，包括 <code>dep</code>，<code>cargo</code> 和 <code>pip</code> 等，采用的都是总是选择允许的最新版本（<code>use the newest allowed version</code>）策略。这会带来两个问题：</p>
<ul>
<li>第一，<code>允许的最新版本</code>可能会随着外部事件而发生变化，比如说在构建的时候，依赖的一个库刚好发布了一个新版本，这会导致可重现构建失效；</li>
<li>第二，开发者为了避免依赖在构建期间发生变化，他必须显式的告诉依赖管理工具我不要哪些版本，比如：<code>&gt;= 0.3, &lt;= 0.4</code>。这会导致依赖管理工具花费大量的时间去计算可用的版本，而最终的结果总是让人感到沮丧，A 依赖需要 <code>Z &gt;= 0.5</code> 而 B 依赖需要 <code>Z &lt;= 0.4</code>，关于这一点 Russ Cox 在 <a href="https://research.swtch.com/version-sat" target="_blank" rel="external nofollow noopener noreferrer">Version SAT</a> 给出了更加规范的论述，感兴趣的同学不妨一观。</li>
</ul>
<p>与总是选择允许的最新版本相反，Go Module 默认采用的是总是使用允许的最旧的版本。我们在 <code>go.mod</code> 中描述的 <code>vX.Y.Z</code> 实际上是在告诉编译器：“Hey，我最少需要 <code>vX.Y.Z</code> 才能被 Build 出来”，编译器听完了所有模块的话之后按照刚才描述的流程就能选择出允许的最旧的那个版本。</p>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><h3 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h3><p>你可以在 <code>$GOPATH/src</code> 之外的任何地方创建一个新的目录存放工程代码，在工程目录下初始化一个新的模块</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go mod init github.com/SimpCosm/godemo/gomod</span><br><span class="line">go: creating new go.mod: module github.com/SimpCosm/godemo/gomod</span><br></pre></td></tr></table></figure>
<p>成功之后你会发现目录下会生成一个 go.mod 文件。首行为当前的模块名称，接下来是 go 的使用版本。这两行和 <code>npm package.json</code> 的 <code>name</code> 和 <code>engine</code> 字段的功能很类似。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat go.mod</span><br><span class="line">module github.com/SimpCosm/godemo/gomod</span><br><span class="line"></span><br><span class="line">go 1.14</span><br></pre></td></tr></table></figure>
<p>创建一个文件 main.go 然后加入以下代码，这里直接 import 了 Go 维护者 Russ Cox 写一个简单的库，</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"rsc.io/quote"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(quote.Hello())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译并且运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ go build -o hello</span><br><span class="line">go: finding module <span class="keyword">for</span> package rsc.io/quote</span><br><span class="line">go: downloading rsc.io/quote v1.5.2</span><br><span class="line">go: found rsc.io/quote <span class="keyword">in</span> rsc.io/quote v1.5.2</span><br><span class="line">go: downloading golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c</span><br><span class="line">$ ./hello</span><br><span class="line">Hello, world.</span><br></pre></td></tr></table></figure>
<p><code>go build</code> 之后，会在 <code>go.mod</code> 引入所需要的依赖包。之后再来看看 go.mod 文件的情况，require 就是本项目所需要的所有依赖包 并且在每个依赖包的后面已经表明了版本号。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module github.com/SimpCosm/repo</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.14</span></span><br><span class="line"></span><br><span class="line">require rsc.io/quote v1<span class="number">.5</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>
<h3 id="go-mod-文件解析"><a href="#go-mod-文件解析" class="headerlink" title="go.mod 文件解析"></a>go.mod 文件解析</h3><p>为了更进一步的讲解，我们摘取了 Prometheus 项目的 <code>go.mod</code> 文件的片段</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">module github.com/prometheus/prometheus</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.14</span></span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/Azure/azure-sdk-<span class="keyword">for</span>-<span class="keyword">go</span> v49<span class="number">.2</span><span class="number">.0</span>+incompatible</span><br><span class="line">	  github.com/Azure/<span class="keyword">go</span>-autorest/autorest/to v0<span class="number">.3</span><span class="number">.0</span> <span class="comment">// indirect</span></span><br><span class="line">	  github.com/docker/docker v20<span class="number">.10</span><span class="number">.1</span>+incompatible</span><br><span class="line">	  github.com/prometheus/client_golang v1<span class="number">.9</span><span class="number">.0</span></span><br><span class="line">	  github.com/dgryski/<span class="keyword">go</span>-sip13 v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200911182023</span><span class="number">-62</span>edffca9245</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">exclude (</span><br><span class="line">    <span class="comment">// Exclude pre-go-mod kubernetes tags, as they are older</span></span><br><span class="line">	  <span class="comment">// than v0.x releases but are picked when we update the dependencies.</span></span><br><span class="line">	  k8s.io/client-<span class="keyword">go</span> v1<span class="number">.4</span><span class="number">.0</span></span><br><span class="line">	  k8s.io/client-<span class="keyword">go</span> v1<span class="number">.4</span><span class="number">.0</span>+incompatible</span><br><span class="line">  	k8s.io/client-<span class="keyword">go</span> v10<span class="number">.0</span><span class="number">.0</span>+incompatible</span><br><span class="line">	  k8s.io/client-<span class="keyword">go</span> v11<span class="number">.0</span><span class="number">.0</span>+incompatible</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">replace (</span><br><span class="line">	k8s.io/klog =&gt; github.com/simonpasquier/klog-gokit v0<span class="number">.3</span><span class="number">.0</span></span><br><span class="line">	k8s.io/klog/v2 =&gt; github.com/simonpasquier/klog-gokit/v2 v2<span class="number">.0</span><span class="number">.1</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>module：用于定义当前项目的模块路径</li>
<li>go：用于标识当前模块的 Go 语言版本，值为初始化模块时的版本，目前来看还只是个标识作用</li>
<li>require：用于设置一个特定的模块版本</li>
<li>exclude：用于从使用中排除一个特定的模块版本</li>
<li>replace：用于将一个模块版本替换为另外一个模块版本。因为有些私有模块无法通过 <code>go get</code> 获取到，可以通过 replace 指令用本地模块替换。</li>
</ul>
<p>在 <code>require</code> 指令中，你会发现 <code>github.com/Azure/go-autorest/autorest/to v0.3.0</code> 的后面会有一个 <code>indirect</code> 标识，indirect 标识表示该模块为间接依赖，也就是在当前应用程序中的 import 语句中，并没有发现这个模块的明确引用，有可能是你先手动 <code>go get</code> 拉取下来的，也有可能是你所依赖的模块所依赖的，情况有好几种。</p>
<p>另外，你也可以看到有一个 <code>+incompatible</code>后缀，这是因为引入的这个 v2+ package 还没有采用 go modules，并且其有一个有效的 <code>semver</code> tag，这时候会添加一个 <code>+incompatible</code>后缀。</p>
<blockquote>
<p><strong>Can a module consume a v2+ package that has not opted into modules? What does ‘+incompatible’ mean?</strong></p>
<p>Yes, a module can import a v2+ package that has not opted into modules, and if the imported v2+ package has a valid <a href="https://semver.org/" target="_blank" rel="external nofollow noopener noreferrer">semver</a> tag, it will be recorded with a <code>+incompatible</code> suffix.</p>
</blockquote>
<p>我们还看到，对于 <code>github.com/dgryski/go-sip13</code> 这个项目，其版本号是 <code>v0.0.0</code> 并且后面跟随着一串时间和哈希值。这是因为这个模块还没有发布过 tag，因此它默认取的是主分支最新一次 commit 的 commit 时间和 commithash，也就是 <code>20200911182023-62edffca9245</code>。需要注意的是，所拉取版本的 commit 时间是以UTC时区为准，而并非本地时区。</p>
<p>exclude 和 replace 这两个动词只作用于当前主模块，也就是当前项目，它所依赖的那些其他模块版本中如果出现了你待替换的那个模块版本的话，Go modules 还是会为你依赖的那个模块版本去拉取你的这个待替换的模块版本。</p>
<p>举个例子，比如项目 A 直接依赖了模块 B 和模块 C，然后模块 B 也直接依赖了模块 C，那么你在项目 A 中的 go.mod 文件里的 <code>replace c=&gt;~/some/path/c</code> 是只会影响项目 A 里写的代码中，而模块 B 所用到的还是你 replace 之前的那个 c，并不是你替换成的 <code>~/some/path/c</code> 这个。</p>
<h3 id="go-sum-文件解析"><a href="#go-sum-文件解析" class="headerlink" title="go.sum 文件解析"></a>go.sum 文件解析</h3><p>与此同时，工程目录下多了一个 <code>go.sum</code>文件，有点类似于 <code>npm package-lock.json</code>,其详细罗列了当前项目直接或间接依赖的所有模块版本，并写明了那些模块版本的 SHA-256 哈希值以备 Go 在今后的操作中保证项目所依赖的那些模块版本不会被篡改。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">golang.org&#x2F;x&#x2F;text v0.0.0-20170915032832-14c0d48ead0c h1:qgOY6WgZOaTkIIMiVjBQcw93ERBE4m30iBm00nkL0i8&#x3D;</span><br><span class="line">golang.org&#x2F;x&#x2F;text v0.0.0-20170915032832-14c0d48ead0c&#x2F;go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi&#x2F;IjpwHt7yyuwOQ&#x3D;</span><br><span class="line">rsc.io&#x2F;quote v1.5.2 h1:w5fcysjrx7yqtD&#x2F;aO+QwRjYZOKnaM9Uh2b40tElTs3Y&#x3D;</span><br><span class="line">rsc.io&#x2F;quote v1.5.2&#x2F;go.mod h1:LzX7hefJvL54yjefDEDHNONDjII0t9xZLPXsUe+TKr0&#x3D;</span><br><span class="line">rsc.io&#x2F;sampler v1.3.0 h1:7uVkIFmeBqHfdjD+gZwtXXI+RODJ2Wc4O7MPEh&#x2F;QiW4&#x3D;</span><br><span class="line">rsc.io&#x2F;sampler v1.3.0&#x2F;go.mod h1:T1hPZKmBbMNahiBKFy5HrXp6adAjACjK9JXDnKaTXpA&#x3D;</span><br></pre></td></tr></table></figure>
<p>可以看到对于每个模块，在 <code>go.sum</code> 中会有两行信息：</p>
<ul>
<li>第一行信息是对于该 module 的该版本下整个 module 下所有文件得到的 hash</li>
<li>第二行信息，也就是加上了 <code>/go.mod</code> 的 hash，是对该 module 的该版本的 <code>go.mod</code> 文件得到的 hash</li>
<li>每个hash前面有一个 h1 的前缀，这个是以 <code>h&lt;N&gt;:</code>的模式，目前仅仅定义了 h1，使用的是 SHA-256 算法</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># format: &lt;module&gt; &lt;version&gt;[/go.mod] &lt;hash&gt;</span></span><br><span class="line">rsc.io/quote v1.5.2 h1:w5fcysjrx7yqtD/aO+QwRjYZOKnaM9Uh2b40tElTs3Y=</span><br><span class="line">rsc.io/quote v1.5.2/go.mod h1:LzX7hefJvL54yjefDEDHNONDjII0t9xZLPXsUe+TKr0=</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Q：在 go.sum 文件中的一个模块版本的 Hash 校验数据什么情况下会成对出现，什么情况下只会存在一行？</strong></p>
<p><strong>A：</strong>通常情况下，在 go.sum 文件中的一个模块版本的 Hash 校验数据会有两行，前一行是该模块的 ZIP 文件的 Hash 校验数据，后一行是该模块的 go.mod 文件的 Hash 校验数据。但是也有些情况下只会出现一行该模块的 go.mod 文件的 Hash 校验数据，而不包含该模块的 ZIP 文件本身的 Hash 校验数据，这个情况发生在 Go modules 判定为你当前这个项目完全用不到该模块，根本也不会下载该模块的 ZIP 文件，所以就没必要对其作出 Hash 校验保证，只需要对该模块的 go.mod 文件作出 Hash 校验保证即可，因为 go.mod 文件是用得着的，在深入挖取项目依赖的时候要用。</p>
</blockquote>
<h3 id="查看全局缓存"><a href="#查看全局缓存" class="headerlink" title="查看全局缓存"></a>查看全局缓存</h3><p>gomod 不会在 <code>$GOPATH/src</code> 目录下保存 <code>rsc.io/quote</code> 包的源码，而是包源码和链接库保存在 <code>$GOPATH/pkg/mod</code> 目录下。在 Go 1.15 版本后，增加了环境变量 <code>GOMODCACHE</code> 可以用来配置 module cache 存放的位置，其默认值为 <code>GOPATH[0]/pkg/mod</code>：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">mod</span></span><br><span class="line">├── <span class="selector-tag">cache</span></span><br><span class="line">├── <span class="selector-tag">github</span><span class="selector-class">.com</span></span><br><span class="line">├── <span class="selector-tag">golang</span><span class="selector-class">.org</span></span><br><span class="line">├── <span class="selector-tag">google</span><span class="selector-class">.golang</span><span class="selector-class">.org</span></span><br><span class="line">├── <span class="selector-tag">gopkg</span><span class="selector-class">.in</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>需要注意的是同一个模块版本的数据只缓存一份，所有其它模块共享使用。如果你希望清理所有已缓存的模块版本数据，可以执行 <code>go clean -modcache</code> 命令。</p>
<p>除了 <code>go run</code> 命令以外，<code>go build</code>、<code>go test</code> 等命令也能自动下载相关依赖包。</p>
<h3 id="依赖升级"><a href="#依赖升级" class="headerlink" title="依赖升级"></a>依赖升级</h3><p>首先通过 <code>go list -u -m all</code> 命令可以查看所有直接和非直接依赖可用的升级补丁：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ go list -u -m all <span class="comment"># 查看所有直接和非直接依赖可用的升级补丁</span></span><br><span class="line">github.com/SimpCosm/godemo/gomod</span><br><span class="line">golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c [v0.3.5]</span><br><span class="line">rsc.io/quote v1.5.2</span><br><span class="line">rsc.io/sampler v1.3.0 [v1.99.99]</span><br></pre></td></tr></table></figure>
<p>在 go module 中，<code>go get</code> 的作用是负责为当前正在开发的 module 来解析和添加依赖，然后构建和安装它们。对于每一个依赖包，<code>go get</code> 必须决定拉取哪一个版本。如果执行 <code>go get</code>命令指定了版本，则按照给定的版本拉取依赖包，如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>go get golang.org/x/text@latest</td>
<td>拉取最新的版本，若存在tag，则优先使用</td>
</tr>
<tr>
<td>go get golang.org/x/text@master</td>
<td>拉取 master 分支的最新 commit</td>
</tr>
<tr>
<td>go get golang.org/x/text@v0.3.2</td>
<td>拉取 tag 为 v0.3.2 的 commit</td>
</tr>
<tr>
<td>go get golang.org/x/text@342b2e</td>
<td>拉取 hash 为 342b231 的 commit，最终会被转换为 v0.3.2</td>
</tr>
</tbody>
</table>
</div>
<p>如果执行 <code>go get</code>没有指定版本，则按照下面逻辑确定版本：</p>
<ul>
<li>默认情况下，<code>go get</code> 选择的是最新的 <code>tagged release version</code> ，比如 <code>v0.4.5</code> 或者 <code>v1.2.3</code>。</li>
<li>如果没有  <code>tagged release version</code> ，则选择最新的 <code>tagged pre-release version</code>，比如 <code>v0.0.1-pre1</code>。</li>
<li>如果连  <code>tagged pre-release version</code> 也没有，则选择最新的已知 commit。</li>
</ul>
<p>尽管 <code>go get</code>命令默认拉取最新的模块，但是它并不会使用该模块的依赖的最新版本，相反而是使用该模块请求依赖的版本。举个例子，模块 A 的最新版本 require 模块 B 的 v1.2.3，同时 B 的 v1.2.4 和 v1.3.1 版本同时存在。那么，执行 <code>go get A</code> 将会使用 A 的最新版本，但是使用 B v1.2.3 版本，正如在 A 的 <code>go.mod</code> 中请求的一样。</p>
<p><code>go get -u</code> 则在默认拉取模块 A 的最新版本情况下，也会使用模块 A 依赖的模块最新版本（同一个 major 版本内的最新版本）。在上面的例子中，<code>go get -u A</code> 将会使用 A 的最新版本，但是使用 B v1.3.1 版本。如果模块 B 依赖于模块 C，但是模块 A 不依赖于模块C，则模块C不会被更新。</p>
<p><code>go get -u=patch</code>则是默认选择模块 A 的最新 <strong>patch版本</strong>，也会使用模块 A 依赖的模块最新的 <strong>patch版本</strong>。在上面的例子中，<code>go get -u=patch A@latest</code> 将会使用 A 的最新版本，但是使用 B v1.2.4 版本。而命令 <code>go get -u=patch A</code> 则使用模块 A 的一个 <code>patch release</code> 版本。</p>
<p>升级次级或补丁版本号：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u rsc.io/quote</span><br></pre></td></tr></table></figure>
<p>仅升级补丁版本号：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u=patch rscio/quote</span><br></pre></td></tr></table></figure>
<p>升降级版本号，可以使用比较运算符控制：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get foo@<span class="string">'&lt;v1.6.2'</span></span><br></pre></td></tr></table></figure>
<p>总结一下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>go get</td>
<td>拉取依赖，会进行指定性拉取，并不会更新所依赖的其它模块。</td>
</tr>
<tr>
<td>go get -u</td>
<td>只会更新主要模块，忽略了单元测试</td>
</tr>
<tr>
<td>go get -u -t</td>
<td>只会更新主要模块，考虑了单元测试</td>
</tr>
<tr>
<td>go get -u ./…</td>
<td>递归更新所有子目录的所有模块，没考虑了单元测试</td>
</tr>
<tr>
<td>go get -u -t ./…</td>
<td>递归更新所有子目录的所有模块，但是考虑了单元测试</td>
</tr>
<tr>
<td>go get -u all</td>
<td>更新所有模块，推荐使用</td>
</tr>
</tbody>
</table>
</div>
<h3 id="移除依赖"><a href="#移除依赖" class="headerlink" title="移除依赖"></a>移除依赖</h3><p>当前代码中不需要了某些包，删除相关代码片段后并没有在 <code>go.mod</code> 文件中自动移出。</p>
<p>运行下面命令可以移出所有代码中不需要的包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod tidy</span><br></pre></td></tr></table></figure>
<p>如果仅仅修改 <code>go.mod</code> 配置文件的内容，那么可以运行 <code>go mod edit --droprequire=path</code>，比如要移出 <code>golang.org/x/crypto</code> 包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod edit --droprequire=golang.org/x/crypto</span><br></pre></td></tr></table></figure>
<h3 id="查看依赖包"><a href="#查看依赖包" class="headerlink" title="查看依赖包"></a>查看依赖包</h3><p>可以直接查看 <code>go.mod</code> 文件，或者使用命令行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ go list -m all</span><br><span class="line">github.com/SimpCosm/godemo/gomod</span><br><span class="line">golang.org/x/text v0.0.0-20170915032832-14c0d48ead0c</span><br><span class="line">rsc.io/quote v1.5.2</span><br><span class="line">rsc.io/sampler v1.3.0</span><br><span class="line">$ go list -m -json all <span class="comment"># json 格式输出</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"Path"</span>: <span class="string">"github.com/SimpCosm/godemo/gomod"</span>,</span><br><span class="line">	<span class="string">"Main"</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="string">"Dir"</span>: <span class="string">"/Users/houmin/project/cosmos/godemo/gomod"</span>,</span><br><span class="line">	<span class="string">"GoMod"</span>: <span class="string">"/Users/houmin/project/cosmos/godemo/gomod/go.mod"</span>,</span><br><span class="line">	<span class="string">"GoVersion"</span>: <span class="string">"1.14"</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"Path"</span>: <span class="string">"golang.org/x/text"</span>,</span><br><span class="line">	<span class="string">"Version"</span>: <span class="string">"v0.0.0-20170915032832-14c0d48ead0c"</span>,</span><br><span class="line">	<span class="string">"Time"</span>: <span class="string">"2017-09-15T03:28:32Z"</span>,</span><br><span class="line">	<span class="string">"Indirect"</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="string">"Dir"</span>: <span class="string">"/Users/houmin/go/pkg/mod/golang.org/x/text@v0.0.0-20170915032832-14c0d48ead0c"</span>,</span><br><span class="line">	<span class="string">"GoMod"</span>: <span class="string">"/Users/houmin/go/pkg/mod/cache/download/golang.org/x/text/@v/v0.0.0-20170915032832-14c0d48ead0c.mod"</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"Path"</span>: <span class="string">"rsc.io/quote"</span>,</span><br><span class="line">	<span class="string">"Version"</span>: <span class="string">"v1.5.2"</span>,</span><br><span class="line">	<span class="string">"Time"</span>: <span class="string">"2018-02-14T15:44:20Z"</span>,</span><br><span class="line">	<span class="string">"Dir"</span>: <span class="string">"/Users/houmin/go/pkg/mod/rsc.io/quote@v1.5.2"</span>,</span><br><span class="line">	<span class="string">"GoMod"</span>: <span class="string">"/Users/houmin/go/pkg/mod/cache/download/rsc.io/quote/@v/v1.5.2.mod"</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"Path"</span>: <span class="string">"rsc.io/sampler"</span>,</span><br><span class="line">	<span class="string">"Version"</span>: <span class="string">"v1.3.0"</span>,</span><br><span class="line">	<span class="string">"Time"</span>: <span class="string">"2018-02-13T19:05:03Z"</span>,</span><br><span class="line">	<span class="string">"Indirect"</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="string">"Dir"</span>: <span class="string">"/Users/houmin/go/pkg/mod/rsc.io/sampler@v1.3.0"</span>,</span><br><span class="line">	<span class="string">"GoMod"</span>: <span class="string">"/Users/houmin/go/pkg/mod/cache/download/rsc.io/sampler/@v/v1.3.0.mod"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="模块配置文本格式化"><a href="#模块配置文本格式化" class="headerlink" title="模块配置文本格式化"></a>模块配置文本格式化</h3><p>由于可手动修改 go.mod 文件，所以可能此文件并没有被格式化，使用下面命令进行文本格式化。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod edit -fmt</span><br></pre></td></tr></table></figure>
<h3 id="从老项目迁移"><a href="#从老项目迁移" class="headerlink" title="从老项目迁移"></a>从老项目迁移</h3><p>从很多第三方的包管理工具迁移到 gomod 特别简单，直接运行 <code>go mod init</code> 即可。如果没有使用任何第三方包管理工具，除了运行 <code>go mod init</code> 初始化以外，还要使用 <code>go get ./...</code> 下载安装所有依赖包，并更新 <code>go.mod</code> 和 <code>go.sum</code> 文件。</p>
<p>默认情况下，<code>go get</code> 命令使用 <code>@latest</code> 版本控制符对所有依赖进行下载，如果想要更改某一个包的版本，可以使用 <code>go mod edit --require</code> 命令，比如要更新 <code>rsc.io/quote</code> 到 v3.1.0 版本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod edit --require=rsc.io/quote@v3.1.0</span><br></pre></td></tr></table></figure>
<h2 id="依赖拉取"><a href="#依赖拉取" class="headerlink" title="依赖拉取"></a>依赖拉取</h2><p>Go Module 方案通过 <code>Semantic Import Versioning</code> 和 <code>Minimal Version Selection</code>，解决了Go语言项目中的依赖管理问题。但是，即使我们确定了我们依赖的版本，我们如何保证这个版本能够被可靠的拉取到，并且不会被篡改呢？这就引入 Go Proxy 和 Go Checksum Database，<a href="https://about.sourcegraph.com/go/gophercon-2019-go-module-proxy-life-of-a-query/" target="_blank" rel="external nofollow noopener noreferrer">Go module proxy life of a query</a> 非常形象地介绍了 Go Proxy 和 Go Checksum Database 出现的原因和他们是如何解决问题的。这里总结两个主要的原因：</p>
<ul>
<li>如果你依赖的项目作者不再维护自己的代码了，比如说他将原来代码放在 Github 上，有一天突然删除了自己的repo，那么这时你再也不能获得你的依赖代码，你也就无法实现 <code>Reproducible Build</code></li>
<li>如果你获取到的代码实际上已经被恶意篡改过，那么你构建的程序也就发生了变化。如何能够确认你下载的代码就是你想要的代码呢？</li>
</ul>
<h3 id="Go-Module-Proxy"><a href="#Go-Module-Proxy" class="headerlink" title="Go Module Proxy"></a>Go Module Proxy</h3><p>Go Proxy Module 有以下作用：</p>
<ul>
<li>集中式模块版本管理</li>
<li>加快模块版本的拉取速度</li>
<li>加快项目的构建速度</li>
<li>使 Go 脱离对于 VCS 的依赖</li>
<li>防止项目由于依赖某个模块而被其作者删除而 break 掉</li>
<li>淡化 Vendor 概念</li>
</ul>
<p>Go module proxy 是一个能够响应 GET 请求的 Web 服务器，通过 <code>go help goproxy</code> 可以获取更多信息，其请求包括</p>
<ul>
<li><code>GET $GOPROXY/&lt;module&gt;/@v/list</code> ：返回给定 module 的已知 version 的 list，每行一个 version</li>
<li><code>GET $GOPROXY/&lt;module&gt;/@v/&lt;version&gt;.info</code>：返回一个 JSON 格式的描述该 module 的元数据</li>
<li><code>GET $GOPROXY/&lt;module&gt;/@v/&lt;version&gt;.mod</code>：返回某个 module 指定 version 的 go.mod 文件</li>
<li><code>GET $GOPROXY/&lt;module&gt;/@v/&lt;version&gt;.zip</code>：返回某个 module 指定 version 的 源代码压缩包</li>
<li><code>GET $GOPROXY/&lt;module&gt;/@latest</code>：返回该 module 最新版本的JSON 格式的描述该 module 的元数据</li>
</ul>
<p><img alt data-src="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/blog/2021-02_05_go-module-proxy-life-of-a-query.png"></p>
<p>在当前，module 的元数据格式为，以后可能会被扩展：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Info <span class="keyword">struct</span> &#123;</span><br><span class="line">    Version <span class="keyword">string</span>    <span class="comment">// version string</span></span><br><span class="line">    Time    time.Time <span class="comment">// commit time</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Go 提供了 <code>GOPROXY</code> 环境变量用于配置 Go Module Proxy 地址，其默认值是：<code>https://proxy.golang.org,direct</code>。在国内，<code>proxy.golang.org</code> 无法访问，需要设置国内的 Go 模块代理，执行如下命令：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> env -<span class="keyword">w</span> GOPROXY=http<span class="variable">s:</span>//goproxy.<span class="keyword">cn</span>,direct</span><br></pre></td></tr></table></figure>
<ul>
<li><code>GOPROXY</code>的值是一个以英文逗号 <code>,</code> 分割的 Go 模块代理列表，允许设置多个模块代理，假设你不想使用，也可以将其设置为 <code>off</code> ，这将会禁止 Go 在后续操作中使用任何 Go 模块代理</li>
<li><code>direct</code> 是一个特殊指示符，用于指示 Go 回源到模块版本的源地址去抓取（比如 GitHub 等），场景如下：当值列表中上一个 Go 模块代理返回 404 或 410 错误时，Go 自动尝试列表中的下一个，遇见 <code>direct</code> 时回源，也就是回到源地址去抓取</li>
</ul>
<h3 id="Go-Checksum-Database"><a href="#Go-Checksum-Database" class="headerlink" title="Go Checksum Database"></a>Go Checksum Database</h3><p>Go Checksum Database 用于在拉取模块版本时，保证拉取到的模块版本数据未经过篡改，若发现不一致，也就是可能存在篡改，将会立即中止。</p>
<p><img alt data-src="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/blog/2021-02-05_go-module-sumdb.png"></p>
<p>Go 提供了 <code>GOSUMDB</code> 环境变量用于配置 Go Checksum Database 的地址，其默认值为：<code>sum.golang.org</code>。在国内这个地址也是无法访问的，但是 GOSUMDB 可以被 Go 模块代理所代理。先前我们所设置的模块代理 <code>goproxy.cn</code> 就能支持代理 <code>sum.golang.org</code>，所以在设置 GOPROXY 后，你可以不需要过度关心这个问题。</p>
<p>若对 GOSUMDB 的值有自定义需求，其支持如下格式：</p>
<ul>
<li>格式 1：<code>&lt;SUMDB_NAME&gt;+&lt;PUBLIC_KEY&gt;</code></li>
<li>格式 2：<code>&lt;SUMDB_NAME&gt;+&lt;PUBLIC_KEY&gt; &lt;SUMDB_URL&gt;</code></li>
</ul>
<p>也可以将其设置为 <code>off</code>，也就是禁止 Go 在后续操作中校验模块版本。</p>
<h3 id="拉取私有模块"><a href="#拉取私有模块" class="headerlink" title="拉取私有模块"></a>拉取私有模块</h3><p>常见的公共 Go Module Proxy，比如 <code>proxy.golang.org</code> 和 <code>goproxy.cn</code> 都是无权访问任何人的私有模块的。即使不使用任何 Go Module Proxy，也就是将 <code>GOPROXY</code> 设置为 direct，默认情况下 Go 也是无法抓取私有模块的，参见 <a href="https://golang.org/doc/faq#git_https" target="_blank" rel="external nofollow noopener noreferrer">这里</a> 。</p>
<p>解决的方法是，想办法修改 VCS 的拉取行为，比如使用 git 的时候，在 <code>$HOME/.gitconfig</code> 文件中追加：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[url <span class="string">"ssh://git@github.com/"</span>]</span><br><span class="line">	insteadOf = https://github.com/</span><br></pre></td></tr></table></figure>
<p>给 git 添加了这个配置之后，git 将使用 ssh 协议拉取代码，而不是 HTTPS 协议拉取代码。</p>
<p>与此同时，需要在 <code>GOPROXY</code> 设置一个 fallback 选项，也就是说访问前面的 proxy 地址失败后，使用 direct 去代码原地址拉取</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go env -w GOPROXY=https://goproxy.cn,direct</span><br></pre></td></tr></table></figure>
<p>除此之外，还可以通过 <code>GONOPROXY</code> 或者 <code>GOPRIVATE</code> 环境变量来告诉 Go 在拉取哪些模块时忽略 Go Module Proxy 。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://cacm.acm.org/magazines/2016/7/204032-why-google-stores-billions-of-lines-of-code-in-a-single-repository/pdf" target="_blank" rel="external nofollow noopener noreferrer">Why google stores billions of lines of code in a single repository</a></li>
<li><a href="https://www.youtube.com/watch?v=F8nrpe0XWRg&amp;list=PLq2Nv-Sh8EbbIjQgDzapOFeVfv5bGOoPE&amp;index=3&amp;t=0s" target="_blank" rel="external nofollow noopener noreferrer">Russ Cox 介绍 go module 背后的设计哲学</a></li>
<li><a href="https://go.googlesource.com/proposal/+/master/design/24301-versioned-go.md" target="_blank" rel="external nofollow noopener noreferrer">Go Module Proposal</a></li>
<li><a href="https://research.swtch.com/vgo-mvs" target="_blank" rel="external nofollow noopener noreferrer">Minimal Version Selection</a></li>
<li><a href="https://research.swtch.com/vgo" target="_blank" rel="external nofollow noopener noreferrer">vgo博客系列</a></li>
<li><a href="https://github.com/golang/go/wiki/Modules" target="_blank" rel="external nofollow noopener noreferrer">Go Module Wiki</a></li>
<li><a href="https://about.sourcegraph.com/go/gophercon-2019-go-module-proxy-life-of-a-query/" target="_blank" rel="external nofollow noopener noreferrer">Go module proxy life of a query</a></li>
<li><a href="https://go.googlesource.com/proposal/+/master/design/25530-sumdb.md#proxying-a-checksum-database" target="_blank" rel="external nofollow noopener noreferrer">Proposal: Secure the Public Go Module Ecosystem</a></li>
</ul>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/251346e5/" rel="bookmark">【Go语言设计与实现】Slice</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/b9b1d0f7/" rel="bookmark">【Go语言设计与实现】Array</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/4e214fa9/" rel="bookmark">【Go语言设计与实现】Function</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/e87a4e07/" rel="bookmark">【Go语言设计与实现】String</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/c31234d9/" rel="bookmark">【Go语言设计与实现】Interface</a></div>
    </li>
  </ul>

      
        <div class="reward-container">
  <div></div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/theme/wechatpay.png" alt="Houmin 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/theme/alipay.jpg" alt="Houmin 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Houmin
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://houmin.cc/posts/55d129f1/" title="【Go语言设计与实现】Go Module">http://houmin.cc/posts/55d129f1/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Go/" rel="tag"><i class="fa fa-tag"></i> Go</a>
              <a href="/tags/Dependency-Management/" rel="tag"><i class="fa fa-tag"></i> Dependency Management</a>
              <a href="/tags/Package-Management/" rel="tag"><i class="fa fa-tag"></i> Package Management</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/posts/8e2bf8a2/" rel="next" title="【Go语言设计与实现】Go Scheduler">
                  <i class="fa fa-chevron-left"></i> 【Go语言设计与实现】Go Scheduler
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/posts/726de05a/" rel="prev" title="【Go语言设计与实现】Timer">
                  【Go语言设计与实现】Timer <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="comments"></div>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#依赖管理"><span class="nav-number">1.</span> <span class="nav-text">依赖管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GOPATH"><span class="nav-number">1.1.</span> <span class="nav-text">GOPATH</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vendor"><span class="nav-number">1.2.</span> <span class="nav-text">Vendor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Go-Module"><span class="nav-number">1.3.</span> <span class="nav-text">Go Module</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关键概念"><span class="nav-number">2.</span> <span class="nav-text">关键概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Semantic-Import-Versioning"><span class="nav-number">2.1.</span> <span class="nav-text">Semantic Import Versioning</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Minimal-Version-Selection"><span class="nav-number">2.2.</span> <span class="nav-text">Minimal Version Selection</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用方法"><span class="nav-number">3.</span> <span class="nav-text">使用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#初始化项目"><span class="nav-number">3.1.</span> <span class="nav-text">初始化项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go-mod-文件解析"><span class="nav-number">3.2.</span> <span class="nav-text">go.mod 文件解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go-sum-文件解析"><span class="nav-number">3.3.</span> <span class="nav-text">go.sum 文件解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看全局缓存"><span class="nav-number">3.4.</span> <span class="nav-text">查看全局缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#依赖升级"><span class="nav-number">3.5.</span> <span class="nav-text">依赖升级</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移除依赖"><span class="nav-number">3.6.</span> <span class="nav-text">移除依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看依赖包"><span class="nav-number">3.7.</span> <span class="nav-text">查看依赖包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模块配置文本格式化"><span class="nav-number">3.8.</span> <span class="nav-text">模块配置文本格式化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从老项目迁移"><span class="nav-number">3.9.</span> <span class="nav-text">从老项目迁移</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#依赖拉取"><span class="nav-number">4.</span> <span class="nav-text">依赖拉取</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Go-Module-Proxy"><span class="nav-number">4.1.</span> <span class="nav-text">Go Module Proxy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Go-Checksum-Database"><span class="nav-number">4.2.</span> <span class="nav-text">Go Checksum Database</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#拉取私有模块"><span class="nav-number">4.3.</span> <span class="nav-text">拉取私有模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">5.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Houmin" src="https://cosmos-1251905798.cos.ap-beijing.myqcloud.com/theme/avatar.png">
  <p class="site-author-name" itemprop="name">Houmin</p>
  <div class="site-description" itemprop="description">丈夫拥书万卷，何假南面百城</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">171</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">234</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/SimpCosm" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;SimpCosm" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:weihoumin@gmail.com" title="E-Mail &amp;rarr; mailto:weihoumin@gmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="hitokoto">
    <!-- hitokoto -->
    <div id="hito-expression">:D 获取中...</div>

    <script src="https://cdn.jsdelivr.net/npm/bluebird@3/js/browser/bluebird.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@2.0.3/fetch.min.js"></script>
    <script>
      fetch('https://v1.hitokoto.cn')
        .then(function (res){
          return res.json();
        })
        .then(function (data) {
          var hitokoto = document.getElementById('hito-expression');
          hitokoto.innerText = data.hitokoto + '——【' + data.from + '】';
        })
        .catch(function (err) {
          console.error(err);
        })
    </script>
  </div>

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heartbeat"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Houmin</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">2.2m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">65:30</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>



  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>



  




  <script src="/js/local-search.js"></script>








<script>
if (document.querySelectorAll('div.pdf').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/pdfobject@2/pdfobject.min.js', () => {
    document.querySelectorAll('div.pdf').forEach(element => {
      PDFObject.embed(element.getAttribute('target'), element, {
        pdfOpenParams: {
          navpanes: 0,
          toolbar: 0,
          statusbar: 0,
          pagemode: 'thumbs',
          view: 'FitH'
        },
        PDFJS_URL: '/lib/pdf/web/viewer.html',
        height: element.getAttribute('height') || '800px'
      });
    });
  }, window.PDFObject);
}
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme: 'forest',
      logLevel: 3,
      flowchart: { curve: 'linear' },
      gantt: { axisFormat: '%m/%d/%Y' },
      sequence: { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>



  

  

  


<script>
NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'iEBFuhVyk4tuhVYctQ265uid-gzGzoHsz',
    appKey: 'KGjOktrtgSEWK1v9DYA3T3Az',
    placeholder: "Just go go",
    avatar: 'retro',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: 'zh-cn' || 'zh-cn',
    path: location.pathname,
    recordIP: true,
    serverURLs: ''
  });
}, window.Valine);
</script>

</body>
</html>
